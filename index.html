<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="pageTitle">Curious Genius | Learn to Code — Classes for Ages 5–18</title>
  <meta name="description" content="Curious Genius offers small-group Math, Coding & Robotics for ages 5–18 in NW Calgary. 🎁 First week FREE. Alberta-aligned, Code.org powered." />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="canonical" href="https://curious-genius.github.io/" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Curious Genius — STEM for Ages 5–18 | First Week FREE" />
  <meta property="og:description" content="Small classes. Big projects. Real skills — and your first week is FREE. In-person STEM in Dalhousie CO-OP" />
  <meta property="og:image" content="https://curious-genius.github.io/curious-genius-logo.png" />
  <meta property="og:url" content="https://curious-genius.github.io/" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rubik:wght@400;500;700&family=Cairo:wght@400;600;700&family=Noto+Sans+Gurmukhi:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css?v=20251023" />

  <!-- Minimal RTL helper -->
  <style>
    body.rtl { direction: rtl; }
    body.rtl nav { direction: rtl; }
    body.rtl .btn { letter-spacing: 0; }
    body.rtl ul { padding-inline-start: 0; }
  </style>

  <!-- YAML parser -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js" defer></script>

  <!-- JSON-LD holder (will be filled from business.yaml) -->
  <script type="application/ld+json" id="orgSchema"></script>

  <script>
    // ================= Language + content loader (enhanced) =================
    const supportedLangs = ['en', 'fr', 'es', 'ar', 'pa'];
    const stored = localStorage.getItem('cg_lang');
    const rawLang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
    const browserLang = rawLang.slice(0, 2);
    let currentLang = supportedLangs.includes(stored || '') ? stored : (supportedLangs.includes(browserLang) ? browserLang : 'en');

    let yamlMain = null;        // content.yaml (multi-lingual)
    let orgData = null;         // business.yaml → org object

    async function fetchYaml(path) {
      const res = await fetch(path + `?v=${encodeURIComponent('20251023')}`, { cache: 'no-store' });
      if (!res.ok) throw new Error(`Failed to load ${path} (HTTP ${res.status})`);
      const text = await res.text();
      return jsyaml.load(text);
    }

    async function loadOrgYaml() {
      if (orgData) return orgData;
      const doc = await fetchYaml('business.yaml');
      if (!doc || !doc.org) throw new Error('business.yaml missing `org` root');
      orgData = doc.org;
      return orgData;
    }

    function applyDirectionAndFonts(lang) {
      const html = document.documentElement;
      const body = document.body;
      const isRTL = (lang === 'ar');
      html.setAttribute('lang', lang);
      html.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
      body.classList.toggle('rtl', isRTL);
      if (isRTL) {
        body.style.fontFamily = "'Cairo', 'Rubik', sans-serif";
      } else if (lang === 'pa') {
        body.style.fontFamily = "'Noto Sans Gurmukhi', 'Rubik', sans-serif";
      } else {
        body.style.fontFamily = "'Rubik', sans-serif";
      }
      document.querySelectorAll('.lang-toggle button').forEach(btn => {
        const l = btn.dataset.lang;
        const on = l === lang;
        btn.setAttribute('aria-pressed', on ? 'true' : 'false');
        btn.classList.toggle('is-active', on);
      });
    }

    function t(id, value, fallback='') {
      const el = document.getElementById(id);
      if (el) el.textContent = value ?? fallback;
    }

    function renderContent(content) {
      /* Head & hero */
      document.title = content.title || 'Curious Genius';
      t('pageTitle', content.title);
      const h1 = document.querySelector('.hero h1');
      const h2 = document.querySelector('.hero p');
      if (h1) h1.textContent = content.brand || 'Curious Genius';
      if (h2) h2.textContent = content.tagline || '';

      /* Nav */
      t('navAbout', content.navAbout, 'About');
      t('navPrograms', content.navPrograms, 'Programs');
      t('navApproach', content.navApproach, 'How It Works');
      t('navPortal', content.navPortal, 'Portal');
      t('navContact', content.navContact, 'Contact');
      // Offers replaces Learn
      t('navOffers', content.navOffers, 'Offers');

      // === Offers button wiring ===
      const FB_POST_URL = "https://www.facebook.com/curiousgeniuslearning/posts/pfbid0tFvEJAZDJKj8FLZEjgzW8Arau5r5nSxw2u2gkfQmvBmSkStAqPwVNkwBZjTECqTgl";
      const FB_POST_EMBED = "https://www.facebook.com/plugins/post.php?href=" + encodeURIComponent(FB_POST_URL) + "&show_text=true&width=500";
      const offersBtn = document.getElementById('navOffers');
      if (offersBtn) {
        offersBtn.href = FB_POST_EMBED;
        offersBtn.target = '_blank';
        offersBtn.rel = 'noopener';
        offersBtn.setAttribute('aria-label', 'View our latest Facebook offer');
      }

      /* Hero CTAs */
      t('ctaPrimary', content.ctaPrimary, 'Start Your Free Week');
      t('ctaSecondary', content.ctaSecondary, 'See Programs');

      /* Value props */
      t('propsTitle', content.propsTitle, 'Why families choose Curious Genius');
      t('prop1Title', content.prop1Title, 'Small Classes');
      t('prop1Body', content.prop1Body, '6–8 learners per cohort for focused, individualized attention.');
      t('prop2Title', content.prop2Title, 'Project-Based Learning');
      t('prop2Body', content.prop2Body, 'Kids build real games, apps, and websites they’re proud to show.');
      t('prop3Title', content.prop3Title, 'Trusted Curriculum');
      t('prop3Body', content.prop3Body, 'Aligned to Code.org pathways and industry best practices.');

      /* Programs (realms) */
      t('programsTitle', content.programsTitle || 'Programs by Level');
      const list = document.getElementById('realmsList');
      if (Array.isArray(content.realms)) {
        list.innerHTML = content.realms.map(
          r => `<li class="card" role="listitem">
                  <div class="card-icon" aria-hidden="true">${r.icon || '📚'}</div>
                  <div class="card-body">
                    <h4>${r.name || ''}</h4>
                    <p>${r.description || ''}</p>
                  </div>
                </li>`
        ).join('');
      } else {
        list.innerHTML = '';
      }
      t('btnCurriculum', content.btnCurriculum, 'Explore Curriculum');

      /* Approach */
      t('approachTitle', content.approachTitle, 'How it works');
      t('step1Title', content.step1Title, '1) Free Week');
      t('step1Body',  content.step1Body,  'Your child joins for one week — no fees, no commitment.');
      t('step2Title', content.step2Title, '2) Personalized Plan');
      t('step2Body',  content.step2Body,  'Placement by age and experience, with clear next steps.');
      t('step3Title', content.step3Title, '3) Build & Celebrate');
      t('step3Body',  content.step3Body,  'Weekly classes, visible progress, and showcase days.');

      /* Portal */
      t('portalTitle', content.portalTitle, 'Parent & Student Portal');
      t('portalIntro', content.portalIntro, 'Sign up (parent first), add your student, then log in anytime to manage your schedule.');
      t('portalLoginTitle', content.portalLoginTitle, 'Login');
      t('portalSignupTitle', content.portalSignupTitle, 'Start Your Free Week');

      /* Contact */
      t('contactTitle', content.contactTitle || 'Contact & Location');
      t('mapNote', content.mapNote || '');

      /* Footer */
      t('footerNote', content.footer || '');
    }

    async function loadContent(lang = currentLang) {
      try {
        if (!yamlMain) yamlMain = await fetchYaml('content.yaml');
        if (!yamlMain[lang]) lang = 'en';
        currentLang = lang;

        // Realms
        const realmsPath = `realms_${lang}.yaml`;
        let realmsDoc = {};
        try {
          realmsDoc = await fetchYaml(realmsPath);
          if (!realmsDoc || !Array.isArray(realmsDoc.realms)) throw new Error('Invalid realms format');
        } catch {
          realmsDoc = await fetchYaml('realms_en.yaml').catch(() => ({ realms: [] }));
          if (!realmsDoc || !Array.isArray(realmsDoc.realms)) realmsDoc = { realms: [] };
        }

        // Org YAML
        const org = await loadOrgYaml();

        // Compose
        const content = { ...yamlMain[lang], ...realmsDoc };
        applyDirectionAndFonts(lang);
        renderContent(content);

        // JSON-LD from YAML
        const schemaEl = document.getElementById('orgSchema');
        if (schemaEl && org) schemaEl.textContent = JSON.stringify(org);

        // Footer phone/email from YAML
        const emailLink = document.querySelector('footer a[href^="mailto:"]');
        if (emailLink && org.email) { emailLink.href = `mailto:${org.email}`; emailLink.textContent = org.email; }
        const phoneLink = document.getElementById('footerPhone') || document.querySelector('footer a[href^="tel:"]');
        if (phoneLink && org.telephone) {
          const e164 = org.telephone.replace(/[^+0-9]/g, '').replace(/^1?(\d{10})$/, '+1$1');
          phoneLink.href = `tel:${e164}`;
          phoneLink.textContent = org.telephone;
        }

        // ===== Offers fallback detection =====
        // If Facebook is blocked or slow, point Offers to the in-page #offers section.
        const offersIframe = document.getElementById('offersEmbed');
        const offersBtn = document.getElementById('navOffers');
        let fallbackTimer = setTimeout(() => {
          if (offersBtn) {
            offersBtn.href = '#offers';
            offersBtn.removeAttribute('target');
            offersBtn.removeAttribute('rel');
            offersBtn.setAttribute('aria-label', 'View current offers on this page');
          }
          const fbWrap = document.querySelector('#offers .fb-embed');
          if (fbWrap) fbWrap.classList.add('is-fallback');
        }, 4500);

        if (offersIframe) {
          offersIframe.onload = () => { clearTimeout(fallbackTimer); };
          offersIframe.onerror = () => {
            clearTimeout(fallbackTimer);
            if (offersBtn) { offersBtn.href = '#offers'; offersBtn.removeAttribute('target'); offersBtn.removeAttribute('rel'); }
          };
        }

      } catch (e) {
        console.error(e);
        alert('Failed to load localized content. Check console for details.');
      }
    }

    window.loadContent = loadContent;

    // =============== Mobile nav, accessibility, and widget helpers ===============
    document.addEventListener('DOMContentLoaded', () => {
      const skip = document.querySelector('.skip-link');
      if (skip) {
        skip.addEventListener('click', () => {
          const main = document.querySelector('main');
          if (main) main.setAttribute('tabindex', '-1'), main.focus();
        });
      }

      const burger = document.getElementById('hamburger');
      const nav = document.querySelector('.mainnav');
      if (burger && nav) {
        burger.addEventListener('click', () => {
          const expanded = burger.getAttribute('aria-expanded') === 'true';
          burger.setAttribute('aria-expanded', String(!expanded));
          nav.classList.toggle('open');
        });
        nav.addEventListener('click', (e) => {
          if (e.target.matches('a')) { nav.classList.remove('open'); burger.setAttribute('aria-expanded', 'false'); }
        });
      }

      document.querySelectorAll('.lang-toggle button').forEach(btn => {
        btn.addEventListener('click', () => loadContent(btn.dataset.lang));
      });
    });
  </script>
</head>

<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <!-- NAVBAR -->
  <header class="topbar" role="banner">
    <a class="brand" href="#" aria-label="Curious Genius home">
      <img src="curious-genius-logo.png" alt="Curious Genius Logo" loading="lazy" />
      <span>Curious Genius</span>
    </a>

    <button id="hamburger" class="hamburger" aria-label="Toggle navigation" aria-controls="primary-navigation" aria-expanded="false">
      <span class="hamburger-box" aria-hidden="true"></span>
    </button>

    <nav class="mainnav" id="primary-navigation" aria-label="Primary" role="navigation">
      <a id="navAbout" href="#about"></a>
      <a id="navPrograms" href="#programs"></a>
      <a id="navApproach" href="#approach"></a>
      <a id="navPortal" href="#portal"></a>
      <a id="navContact" href="#contact"></a>
      <a id="navOffers" class="btn btn--ghost" href="" target="_blank" rel="noopener"></a>
    </nav>

    <div class="lang-toggle" role="group" aria-label="Language switcher">
      <button data-lang="en" aria-pressed="false">EN</button>
      <button data-lang="fr" aria-pressed="false">FR</button>
      <button data-lang="es" aria-pressed="false">ES</button>
      <button data-lang="ar" aria-pressed="false">AR</button>
      <button data-lang="pa" aria-pressed="false">PA</button>
    </div>
  </header>

  <main id="main">
    <!-- HERO -->
    <section class="hero">
      <div class="hero__content">
        <h1></h1>
        <p></p>
        <div class="hero__actions">
          <a href="#portal" class="btn" id="ctaPrimary" aria-label="Start your free week at Curious Genius"></a>
          <a href="#programs" class="btn btn--ghost" id="ctaSecondary"></a>
        </div>
      </div>
    </section>

    <!-- VALUE PROPS -->
    <section class="section" id="about">
      <h2 id="propsTitle"></h2>
      <ul class="grid grid--3" role="list">
        <li class="card" role="listitem">
          <div class="card-icon" aria-hidden="true">👩‍🏫</div>
          <h3 id="prop1Title"></h3>
          <p id="prop1Body"></p>
        </li>
        <li class="card" role="listitem">
          <div class="card-icon" aria-hidden="true">🎮</div>
          <h3 id="prop2Title"></h3>
          <p id="prop2Body"></p>
        </li>
        <li class="card" role="listitem">
          <div class="card-icon" aria-hidden="true">✅</div>
          <h3 id="prop3Title"></h3>
          <p id="prop3Body"></p>
        </li>
      </ul>
    </section>

    <!-- PROGRAMS -->
    <section class="section" id="programs">
      <h2 id="programsTitle"></h2>
      <ul id="realmsList" class="grid grid--2 grid--cards" role="list"></ul>
      <div class="center">
        <a href="#portal" class="btn" id="btnCurriculum"></a>
      </div>
    </section>

    <!-- HOW IT WORKS -->
    <section class="section section--alt" id="approach">
      <h2 id="approachTitle"></h2>
      <ul class="steps" role="list">
        <li class="step" role="listitem">
          <div class="step-num">1</div>
          <div class="step-body">
            <h4 id="step1Title"></h4>
            <p id="step1Body"></p>
          </div>
        </li>
        <li class="step" role="listitem">
          <div class="step-num">2</div>
          <div class="step-body">
            <h4 id="step2Title"></h4>
            <p id="step2Body"></p>
          </div>
        </li>
        <li class="step" role="listitem">
          <div class="step-num">3</div>
          <div class="step-body">
            <h4 id="step3Title"></h4>
            <p id="step3Body"></p>
          </div>
        </li>
      </ul>
    </section>

    <!-- PORTAL (Login + Sign Up) -->
    <section class="section" id="portal">
      <h2 id="portalTitle"></h2>
      <p id="portalIntro" class="muted"></p>

      <div class="grid grid--2">
        <!-- Login (parents log in, then book sessions inside the portal) -->
        <div class="card card--widget">
          <h3 id="portalLoginTitle"></h3>
          <div class="widget">
            <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQjNKeSJ9"></script>
          </div>
        </div>

        <!-- Sign Up (Parent first; single student) -->
        <div class="card card--widget">
          <h3 id="portalSignupTitle"></h3>
          <div class="widget" id="signupWidget">
            <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQjJKTSJ9"></script>
          </div>
          <noscript><p class="muted">JavaScript is required to load the sign‑up form.</p></noscript>
        </div>
      </div>
    </section>

    <!-- OFFERS (fallback section) -->
    <section class="section section--alt" id="offers">
      <h2>Offers</h2>
      <div class="grid grid--2">
        <div class="card fb-embed">
          <h3 style="margin-bottom:.5rem">Facebook Post</h3>
          <iframe id="offersEmbed" style="width:100%;max-width:520px;height:420px;border:0;border-radius:12px;overflow:hidden"
            scrolling="no" allow="encrypted-media"
            src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fcuriousgeniuslearning%2Fposts%2Fpfbid0tFvEJAZDJKj8FLZEjgzW8Arau5r5nSxw2u2gkfQmvBmSkStAqPwVNkwBZjTECqTgl&show_text=true&width=500"></iframe>
          <p class="muted" style="margin-top:.5rem">If the post doesn’t load, try the <a href="https://www.facebook.com/curiousgeniuslearning/posts/pfbid0tFvEJAZDJKj8FLZEjgzW8Arau5r5nSxw2u2gkfQmvBmSkStAqPwVNkwBZjTECqTgl" target="_blank" rel="noopener">direct Facebook link</a>.</p>
        </div>
        <div class="card">
          <h3 style="margin-bottom:.5rem">Current Promotions</h3>
          <ul class="muted" style="list-style:disc;padding-left:1.2rem">
            <li><strong>First Week FREE</strong> — try any program in your level (K–3, 4–8, 9–12).</li>
            <li><strong>Sibling Save</strong> — 10% off additional siblings enrolled together.</li>
            <li><strong>Refer a Friend</strong> — both families get a $25 credit.</li>
          </ul>
          <p style="margin-top:.75rem"><a class="btn" href="#portal">Reserve My Free Week</a></p>
        </div>
      </div>
    </section>

    <!-- CONTACT (form + map; phone/email in footer) -->
    <section class="section" id="contact">
      <h2 id="contactTitle"></h2>
      <div class="contact-grid">
        <div class="card card--widget">
          <div class="widget">
            <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQkRKSCJ9"></script>
          </div>
        </div>
        <div class="map">
          <iframe
            src="https://www.google.com/maps?q=Unit%206%2C%205505%20Shaganappi%20Trail%20NW%2C%20Calgary%2C%20AB%20T3A%201Z6&output=embed"
            width="100%" height="350" style="border:0; border-radius:12px;" allowfullscreen loading="lazy"
            referrerpolicy="no-referrer-when-downgrade" title="Curious Genius location map"></iframe>
          <p class="muted" id="mapNote"></p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-inner">
      <p class="contact">
        <strong>Email:</strong> <a href="mailto:learn@curiousgenius.ca">learn@curiousgenius.ca</a>
        <span class="sep" aria-hidden="true">|</span>
        <strong>Phone:</strong> <a id="footerPhone" href="tel:+15872912906">587-291-2906</a>
      </p>
      <p id="footerNote"></p>
    </div>
  </footer>

  <noscript>
    <div style="padding:12px; background:#fff3cd; color:#6b5600; text-align:center;">
      This site uses JavaScript to load content and booking widgets. Please enable JavaScript for the full experience.
    </div>
  </noscript>

  <!-- Kick off i18n once YAML parser has loaded -->
  <script>
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => loadContent());
    } else {
      loadContent();
    }
  </script>
</body>
</html>
