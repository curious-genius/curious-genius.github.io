<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="pageTitle">Curious Genius | Learn to Code — Classes for Ages 5–18</title>
  <meta name="description" content="Curious Genius offers small-group coding classes for ages 5–18 in NW Calgary. Project‑based learning aligned with Code.org. Try a free trial session." />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="canonical" href="https://curious-genius.github.io/" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Curious Genius | Learn to Code — Classes for Ages 5–18" />
  <meta property="og:description" content="Small classes. Big projects. Real skills. In-person coding education in NW Calgary." />
  <meta property="og:image" content="https://curious-genius.github.io/curious-genius-logo.png" />
  <meta property="og:url" content="https://curious-genius.github.io/" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rubik:wght@400;500;700&family=Cairo:wght@400;600;700&family=Noto+Sans+Gurmukhi:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css?v=20251023" />

  <!-- Minimal RTL helper (kept) -->
  <style>
    body.rtl { direction: rtl; }
    body.rtl nav { direction: rtl; }
    body.rtl .btn { letter-spacing: 0; }
    body.rtl ul { padding-inline-start: 0; }
  </style>

  <!-- YAML parser -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js" defer></script>

  <!-- JSON-LD: LocalBusiness -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "EducationalOrganization",
    "name": "Curious Genius",
    "url": "https://curious-genius.github.io/",
    "logo": "https://curious-genius.github.io/curious-genius-logo.png",
    "email": "learn@curiousgenius.ca",
    "telephone": "587-291-2906",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Unit 6, 5505 Shaganappi Trail NW",
      "addressLocality": "Calgary",
      "addressRegion": "AB",
      "postalCode": "T3A 1Z6",
      "addressCountry": "CA"
    },
    "sameAs": [
      "https://curiousgenius.moodlecloud.com/login/index.php"
    ]
  }
  </script>

  <script>
    // ================= Language + content loader (enhanced) =================
    const supportedLangs = ['en', 'fr', 'es', 'ar', 'pa'];
    const stored = localStorage.getItem('cg_lang');
    const rawLang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
    const browserLang = rawLang.slice(0, 2);
    let currentLang = supportedLangs.includes(stored || '') ? stored : (supportedLangs.includes(browserLang) ? browserLang : 'en');

    let yamlMain = null;   // content.yaml (single document with en/fr/es/ar/pa)

    async function fetchYaml(path) {
      const res = await fetch(path + `?v=${encodeURIComponent('20251023')}`, { cache: 'no-store' });
      if (!res.ok) throw new Error(`Failed to load ${path} (HTTP ${res.status})`);
      const text = await res.text();
      return jsyaml.load(text);
    }

    function applyDirectionAndFonts(lang) {
      const html = document.documentElement;
      const body = document.body;
      const isRTL = (lang === 'ar');
      html.setAttribute('lang', lang);
      html.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
      body.classList.toggle('rtl', isRTL);
      if (isRTL) {
        body.style.fontFamily = "'Cairo', 'Rubik', sans-serif";
      } else if (lang === 'pa') {
        body.style.fontFamily = "'Noto Sans Gurmukhi', 'Rubik', sans-serif";
      } else {
        body.style.fontFamily = "'Rubik', sans-serif";
      }
      // Update lang toggle state
      document.querySelectorAll('.lang-toggle button').forEach(btn => {
        const l = btn.dataset.lang;
        const on = l === lang;
        btn.setAttribute('aria-pressed', on ? 'true' : 'false');
        btn.classList.toggle('is-active', on);
      });
    }

    function t(id, value, fallback='') {
      const el = document.getElementById(id);
      if (el) el.textContent = value ?? fallback;
    }

    function renderContent(content) {
      /* Head & hero */
      document.title = content.title || 'Curious Genius';
      t('pageTitle', content.title);
      const h1 = document.querySelector('.hero h1');
      const h2 = document.querySelector('.hero p');
      if (h1) h1.textContent = content.brand || 'Curious Genius';
      if (h2) h2.textContent = content.tagline || '';

      /* Nav */
      t('navAbout', content.navAbout, 'About');
      t('navPrograms', content.navPrograms, 'Programs');
      t('navApproach', content.navApproach, 'How It Works');
      t('navPortal', content.navPortal, 'Portal');
      t('navContact', content.navContact, 'Contact');
      t('navLearn', content.navLearn, 'Learn');

      /* Hero CTAs */
      t('ctaPrimary', content.ctaPrimary, 'Sign Up');
      t('ctaSecondary', content.ctaSecondary, 'See Programs');

      /* Value props */
      t('propsTitle', content.propsTitle, 'Why families choose Curious Genius');
      t('prop1Title', content.prop1Title, 'Small Classes');
      t('prop1Body', content.prop1Body, '6–8 learners per cohort for focused, individualized attention.');
      t('prop2Title', content.prop2Title, 'Project-Based Learning');
      t('prop2Body', content.prop2Body, 'Kids build real games, apps, and websites they’re proud to show.');
      t('prop3Title', content.prop3Title, 'Trusted Curriculum');
      t('prop3Body', content.prop3Body, 'Aligned to Code.org pathways and industry best practices.');

      /* Programs (realms) */
      t('programsTitle', content.programsTitle || 'Programs by Level');
      const list = document.getElementById('realmsList');
      if (Array.isArray(content.realms)) {
        list.innerHTML = content.realms.map(
          r => `<li class="card" role="listitem">
                  <div class="card-icon" aria-hidden="true">${r.icon || '📚'}</div>
                  <div class="card-body">
                    <h4>${r.name || ''}</h4>
                    <p>${r.description || ''}</p>
                  </div>
                </li>`
        ).join('');
      } else {
        list.innerHTML = '';
      }
      t('btnCurriculum', content.btnCurriculum, 'Explore Curriculum');

      /* Approach */
      t('approachTitle', content.approachTitle, 'How it works');
      t('step1Title', content.step1Title, '1) Free Trial');
      t('step1Body',  content.step1Body,  'A 30–45 minute trial to discover interests and fit.');
      t('step2Title', content.step2Title, '2) Personalized Plan');
      t('step2Body',  content.step2Body,  'Placement by age and experience, with clear next steps.');
      t('step3Title', content.step3Title, '3) Build & Celebrate');
      t('step3Body',  content.step3Body,  'Weekly classes, visible progress, and showcase days.');

      /* Portal */
      t('portalTitle', content.portalTitle, 'Parent & Student Portal');
      t('portalIntro', content.portalIntro, 'Sign up (parent first), add your student, then log in anytime to manage your schedule.');
      t('portalLoginTitle', content.portalLoginTitle, 'Login');
      t('portalSignupTitle', content.portalSignupTitle, 'Sign Up');

      /* Contact */
      t('contactTitle', content.contactTitle || 'Contact & Location');
      t('mapNote', content.mapNote || '');

      /* Footer */
      t('footerNote', content.footer || '');
    }

    async function loadContent(lang = currentLang) {
      try {
        if (!yamlMain) yamlMain = await fetchYaml('content.yaml');
        if (!yamlMain[lang]) lang = 'en';
        currentLang = lang;
        localStorage.setItem('cg_lang', lang);

        // Load realms_<lang>.yaml with fallback to en
        const realmsPath = `realms_${lang}.yaml`;
        let realmsDoc = {};
        try {
          realmsDoc = await fetchYaml(realmsPath);
          if (!realmsDoc || !Array.isArray(realmsDoc.realms)) throw new Error('Invalid realms format');
        } catch {
          realmsDoc = await fetchYaml('realms_en.yaml').catch(() => ({ realms: [] }));
          if (!realmsDoc || !Array.isArray(realmsDoc.realms)) realmsDoc = { realms: [] };
        }

        const content = { ...yamlMain[lang], ...realmsDoc };
        applyDirectionAndFonts(lang);
        renderContent(content);
      } catch (e) {
        console.error(e);
        alert('Failed to load localized content. Check console for details.');
      }
    }

    window.loadContent = loadContent;

    // =============== Mobile nav, accessibility, and widget helpers ===============
    document.addEventListener('DOMContentLoaded', () => {
      // Skip-link focus
      const skip = document.querySelector('.skip-link');
      if (skip) {
        skip.addEventListener('click', () => {
          const main = document.querySelector('main');
          if (main) main.setAttribute('tabindex', '-1'), main.focus();
        });
      }

      // Mobile nav toggle
      const burger = document.getElementById('hamburger');
      const nav = document.querySelector('.mainnav');
      if (burger && nav) {
        burger.addEventListener('click', () => {
          const expanded = burger.getAttribute('aria-expanded') === 'true';
          burger.setAttribute('aria-expanded', String(!expanded));
          nav.classList.toggle('open');
        });
        // Close on nav click (small screens)
        nav.addEventListener('click', (e) => {
          if (e.target.matches('a')) {
            nav.classList.remove('open');
            burger.setAttribute('aria-expanded', 'false');
          }
        });
      }

      // Language buttons
      document.querySelectorAll('.lang-toggle button').forEach(btn => {
        btn.addEventListener('click', () => loadContent(btn.dataset.lang));
      });
    });
  </script>
</head>

<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <!-- NAVBAR -->
  <header class="topbar" role="banner">
    <a class="brand" href="#" aria-label="Curious Genius home">
      <img src="curious-genius-logo.png" alt="Curious Genius Logo" loading="lazy" />
      <span>Curious Genius</span>
    </a>

    <button id="hamburger" class="hamburger" aria-label="Toggle navigation" aria-controls="primary-navigation" aria-expanded="false">
      <span class="hamburger-box" aria-hidden="true"></span>
    </button>

    <nav class="mainnav" id="primary-navigation" aria-label="Primary" role="navigation">
      <a id="navAbout" href="#about"></a>
      <a id="navPrograms" href="#programs"></a>
      <a id="navApproach" href="#approach"></a>
      <a id="navPortal" href="#portal"></a>
      <a id="navContact" href="#contact"></a>
     <!-- <a id="navLearn" class="btn btn--ghost" href="" target="_blank" rel="noopener"></a> -->
    </nav>

    <div class="lang-toggle" role="group" aria-label="Language switcher">
      <button data-lang="en" aria-pressed="false">EN</button>
      <button data-lang="fr" aria-pressed="false">FR</button>
      <button data-lang="es" aria-pressed="false">ES</button>
      <button data-lang="ar" aria-pressed="false">AR</button>
      <button data-lang="pa" aria-pressed="false">PA</button>
    </div>
  </header>

  <main id="main">
    <!-- HERO -->
    <section class="hero">
      <div class="hero__content">
        <h1></h1>
        <p></p>
        <div class="hero__actions">
          <a href="#portal" class="btn" id="ctaPrimary"></a>
          <a href="#programs" class="btn btn--ghost" id="ctaSecondary"></a>
        </div>
      </div>
    </section>

    <!-- VALUE PROPS -->
    <section class="section" id="about">
      <h2 id="propsTitle"></h2>
      <ul class="grid grid--3" role="list">
        <li class="card" role="listitem">
          <div class="card-icon" aria-hidden="true">👩‍🏫</div>
          <h3 id="prop1Title"></h3>
          <p id="prop1Body"></p>
        </li>
        <li class="card" role="listitem">
          <div class="card-icon" aria-hidden="true">🎮</div>
          <h3 id="prop2Title"></h3>
          <p id="prop2Body"></p>
        </li>
        <li class="card" role="listitem">
          <div class="card-icon" aria-hidden="true">✅</div>
          <h3 id="prop3Title"></h3>
          <p id="prop3Body"></p>
        </li>
      </ul>
    </section>

    <!-- PROGRAMS -->
    <section class="section" id="programs">
      <h2 id="programsTitle"></h2>
      <ul id="realmsList" class="grid grid--2 grid--cards" role="list"></ul>
      <div class="center">
        <a href="#portal" class="btn" id="btnCurriculum"></a>
      </div>
    </section>

    <!-- HOW IT WORKS -->
    <section class="section section--alt" id="approach">
      <h2 id="approachTitle"></h2>
      <ul class="steps" role="list">
        <li class="step" role="listitem">
          <div class="step-num">1</div>
          <div class="step-body">
            <h4 id="step1Title"></h4>
            <p id="step1Body"></p>
          </div>
        </li>
        <li class="step" role="listitem">
          <div class="step-num">2</div>
          <div class="step-body">
            <h4 id="step2Title"></h4>
            <p id="step2Body"></p>
          </div>
        </li>
        <li class="step" role="listitem">
          <div class="step-num">3</div>
          <div class="step-body">
            <h4 id="step3Title"></h4>
            <p id="step3Body"></p>
          </div>
        </li>
      </ul>
    </section>

    <!-- PORTAL (Login + Sign Up) -->
    <section class="section" id="portal">
      <h2 id="portalTitle"></h2>
      <p id="portalIntro" class="muted"></p>

      <div class="grid grid--2">
        <!-- Login (parents log in, then book sessions inside the portal) -->
        <div class="card card--widget">
          <h3 id="portalLoginTitle"></h3>
          <div class="widget">
            <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQjNKeSJ9"></script>
          </div>
        </div>

        <!-- Sign Up (Parent first; single student) -->
        <div class="card card--widget">
          <h3 id="portalSignupTitle"></h3>
          <div class="widget" id="signupWidget">
            <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQjJKTSJ9"></script>
          </div>
          <noscript><p class="muted">JavaScript is required to load the sign‑up form.</p></noscript>
          <script>
            (function () {
              const container = document.getElementById('signupWidget');
              if (!container) return;

              const dalhousieSchools = [
                '',
                'Dalhousie School (CBE K–5)',
                'H.D. Cartwright School (CBE 7–9)',
                'Sir Winston Churchill High School (CBE 10–12)',
                'St. Dominic School (CCSD K–6)'
              ];

              const obs = new MutationObserver(() => {
                try {
                  if (container.querySelector('iframe')) { obs.disconnect(); return; }
                  const form = container.querySelector('form') || container;
                  if (!form) return;

                  // Reorder: Parent/Guardian above Student
                  const findHeading = (rx) => Array.from(form.querySelectorAll('h1,h2,h3,h4,h5,h6'))
                    .find(h => rx.test(h.textContent.trim()));
                  const parentH = findHeading(/parent|guardian/i);
                  const studentH = findHeading(/student/i);
                  if (parentH && studentH) {
                    const parentBlock = parentH.nextElementSibling;
                    if (studentH.compareDocumentPosition(parentH) & Node.DOCUMENT_POSITION_FOLLOWING) {
                      form.insertBefore(parentH, studentH);
                      if (parentBlock) form.insertBefore(parentBlock, studentH);
                    }
                  }

                  // Hide Student Phone + Skill Level
                  const hideByLabel = (rx) => {
                    const labels = form.querySelectorAll('label, .field-label, .mdc-floating-label, .mat-mdc-floating-label');
                    labels.forEach(l => {
                      if (rx.test(l.textContent.trim())) {
                        const field = l.closest('.field, .form-group, .mat-mdc-form-field, .tb-field, li, div');
                        if (field) field.style.display = 'none';
                      }
                    });
                  };
                  hideByLabel(/student\s*phone/i);
                  hideByLabel(/skill\s*level/i);

                  // Convert "Current School" to a dropdown with Dalhousie options
                  const labels = Array.from(form.querySelectorAll('label, .field-label, .mdc-floating-label, .mat-mdc-floating-label'));
                  const schoolLabel = labels.find(l => /current\s*school/i.test(l.textContent.trim()));
                  if (schoolLabel) {
                    const fieldWrap = schoolLabel.closest('.field, .form-group, .mat-mdc-form-field, .tb-field, div');
                    const input = fieldWrap && fieldWrap.querySelector('input[type="text"], input:not([type]), textarea');
                    if (input) {
                      const select = document.createElement('select');
                      select.name = input.name || 'currentSchool';
                      select.required = input.required || false;
                      select.style.width = '100%';
                      dalhousieSchools.forEach(v => {
                        const o = document.createElement('option');
                        o.value = v;
                        o.textContent = v || 'Select your school';
                        select.appendChild(o);
                      });
                      input.replaceWith(select);
                    }
                  }

                  obs.disconnect();
                } catch (e) {
                  console.warn('Sign-up tweak warning:', e);
                }
              });

              obs.observe(container, { childList: true, subtree: true });
            })();
          </script>
        </div>
      </div>
    </section>

    <!-- CONTACT (form + map; phone/email in footer) -->
    <section class="section" id="contact">
      <h2 id="contactTitle"></h2>
      <div class="contact-grid">
        <div class="card card--widget">
          <div class="widget">
            <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQkRKSCJ9"></script>
          </div>
        </div>
        <div class="map">
          <iframe
            src="https://www.google.com/maps?q=Unit%207%2C%205505%20Shaganappi%20Trail%20NW%2C%20Calgary%2C%20AB%20T3A%201Z6&output=embed"
            width="100%" height="350" style="border:0; border-radius:12px;" allowfullscreen loading="lazy"
            referrerpolicy="no-referrer-when-downgrade" title="Curious Genius location map"></iframe>
          <p class="muted" id="mapNote"></p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-inner">
      <p class="contact">
        <strong>Email:</strong> <a href="mailto:learn@curiousgenius.ca">learn@curiousgenius.ca</a>
        <span class="sep" aria-hidden="true">|</span>
        <strong>Phone:</strong> <a href="tel:14038301013">403-830-1013</a>
      </p>
      <p id="footerNote"></p>
    </div>
  </footer>

  <noscript>
    <div style="padding:12px; background:#fff3cd; color:#6b5600; text-align:center;">
      This site uses JavaScript to load content and booking widgets. Please enable JavaScript for the full experience.
    </div>
  </noscript>

  <!-- Kick off i18n once YAML parser has loaded -->
  <script>
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => loadContent());
    } else {
      loadContent();
    }
  </script>
</body>
</html>
