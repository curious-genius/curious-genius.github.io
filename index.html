<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="pageTitle"></title>
  <link rel="icon" href="favicon.ico" type="image/x-icon"/>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rubik:wght@400;500;700&family=Cairo:wght@400;600;700&family=Noto+Sans+Gurmukhi:wght@400;600;700&display=swap" rel="stylesheet"/>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css?v=20250926"/>

  <!-- Minimal RTL helper -->
  <style>
    body.rtl { direction: rtl; }
    body.rtl nav { direction: rtl; }
    body.rtl .btn { letter-spacing: 0; }
    body.rtl ul { padding-inline-start: 0; }
  </style>

  <!-- YAML parser -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

  <script>
    /* ---------------- Language + content loader ---------------- */
    const supportedLangs = ['en', 'fr', 'es', 'ar', 'pa'];
    const rawLang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
    const browserLang = rawLang.slice(0, 2);
    let currentLang = supportedLangs.includes(browserLang) ? browserLang : 'en';

    let yamlMain = null;   // content.yaml (single document with en/fr/es/ar/pa)

    async function fetchYaml(path) {
      const res = await fetch(path, { cache: 'no-store' });
      if (!res.ok) throw new Error(`Failed to load ${path} (HTTP ${res.status})`);
      const text = await res.text();
      return jsyaml.load(text);
    }

    function applyDirectionAndFonts(lang) {
      const html = document.documentElement;
      const body = document.body;
      const isRTL = (lang === 'ar');
      html.setAttribute('lang', lang);
      html.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
      body.classList.toggle('rtl', isRTL);
      if (isRTL) {
        body.style.fontFamily = "'Cairo', 'Rubik', sans-serif";
      } else if (lang === 'pa') {
        body.style.fontFamily = "'Noto Sans Gurmukhi', 'Rubik', sans-serif";
      } else {
        body.style.fontFamily = "'Rubik', sans-serif";
      }
    }

    function t(id, value, fallback='') {
      const el = document.getElementById(id);
      if (el) el.textContent = value ?? fallback;
    }

    function renderContent(content) {
      /* Head & hero */
      document.title = content.title || 'Curious Genius';
      t('pageTitle', content.title);
      const h1 = document.querySelector('.hero h1');
      const h2 = document.querySelector('.hero p');
      if (h1) h1.textContent = content.brand || 'Curious Genius';
      if (h2) h2.textContent = content.tagline || '';

      /* Nav */
      t('navAbout', content.navAbout, 'About');
      t('navPrograms', content.navPrograms, 'Programs');
      t('navApproach', content.navApproach, 'How It Works');
      t('navPortal', content.navPortal, 'Portal');
      t('navContact', content.navContact, 'Contact');
      t('navLearn', content.navLearn, 'Learn');

      /* Hero CTAs */
      t('ctaPrimary', content.ctaPrimary, 'Sign Up');
      t('ctaSecondary', content.ctaSecondary, 'See Programs');

      /* Value props */
      t('propsTitle', content.propsTitle, 'Why families choose Curious Genius');
      t('prop1Title', content.prop1Title, 'Small Classes');
      t('prop1Body', content.prop1Body, '6‚Äì8 learners per cohort for focused, individualized attention.');
      t('prop2Title', content.prop2Title, 'Project-Based Learning');
      t('prop2Body', content.prop2Body, 'Kids build real games, apps, and websites they‚Äôre proud to show.');
      t('prop3Title', content.prop3Title, 'Trusted Curriculum');
      t('prop3Body', content.prop3Body, 'Aligned to Code.org pathways and industry best practices.');

      /* Programs (realms) */
      t('programsTitle', content.programsTitle || 'Programs by Level');
      const list = document.getElementById('realmsList');
      if (Array.isArray(content.realms)) {
        list.innerHTML = content.realms.map(
          r => `<li class="card">
                  <div class="card-icon">${r.icon}</div>
                  <div class="card-body">
                    <h4>${r.name}</h4>
                    <p>${r.description}</p>
                  </div>
                </li>`
        ).join('');
      } else {
        list.innerHTML = '';
      }
      t('btnCurriculum', content.btnCurriculum, 'Explore Curriculum');

      /* Approach */
      t('approachTitle', content.approachTitle, 'How it works');
      t('step1Title', content.step1Title, '1) Free Trial');
      t('step1Body',  content.step1Body,  'A 30‚Äì45 minute trial to discover interests and fit.');
      t('step2Title', content.step2Title, '2) Personalized Plan');
      t('step2Body',  content.step2Body,  'Placement by age and experience, with clear next steps.');
      t('step3Title', content.step3Title, '3) Build & Celebrate');
      t('step3Body',  content.step3Body,  'Weekly classes, visible progress, and showcase days.');

      /* Portal */
      t('portalTitle', content.portalTitle, 'Parent & Student Portal');
      t('portalIntro', content.portalIntro, 'Sign up (parent first), add your student, then log in anytime to manage your schedule.');
      t('portalLoginTitle', content.portalLoginTitle, 'Login');
      t('portalSignupTitle', content.portalSignupTitle, 'Sign Up');
      /* Contact */
      t('contactTitle', content.contactTitle || 'Contact & Location');
      t('mapNote', content.mapNote || '');

      /* Footer */
      t('footerNote', content.footer || '');
    }

    async function loadContent(lang = currentLang) {
      try {
        if (!yamlMain) yamlMain = await fetchYaml('content.yaml');
        if (!yamlMain[lang]) lang = 'en';
        currentLang = lang;

        // Load realms_<lang>.yaml with fallback to en
        const realmsPath = `realms_${lang}.yaml`;
        let realmsDoc = {};
        try {
          realmsDoc = await fetchYaml(realmsPath);
          if (!realmsDoc || !Array.isArray(realmsDoc.realms)) throw new Error('Invalid realms format');
        } catch {
          realmsDoc = await fetchYaml('realms_en.yaml').catch(() => ({ realms: [] }));
          if (!realmsDoc || !Array.isArray(realmsDoc.realms)) realmsDoc = { realms: [] };
        }

        const content = { ...yamlMain[lang], ...realmsDoc };
        applyDirectionAndFonts(lang);
        renderContent(content);
      } catch (e) {
        console.error(e);
        alert('Failed to load localized content. Check console for details.');
      }
    }

    window.loadContent = loadContent;
  </script>
</head>

<body onload="loadContent()">
  <!-- NAVBAR -->
  <header class="topbar">
    <a class="brand" href="#">
      <img src="curious-genius-logo.png" alt="Curious Genius Logo"/>
      <span>Curious Genius</span>
    </a>
    <nav class="mainnav">
      <a id="navAbout" href="#about"></a>
      <a id="navPrograms" href="#programs"></a>
      <a id="navApproach" href="#approach"></a>
      <a id="navPortal" href="#portal"></a>
      <a id="navContact" href="#contact"></a>
      <a id="navLearn" class="btn btn--ghost" href="https://curiousgenius.moodlecloud.com/login/index.php" target="_blank" rel="noopener"></a>
    </nav>
    <div class="lang-toggle">
      <button onclick="loadContent('en')">EN</button>
      <button onclick="loadContent('fr')">FR</button>
      <button onclick="loadContent('es')">ES</button>
      <button onclick="loadContent('ar')">AR</button>
      <button onclick="loadContent('pa')">PA</button>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero__content">
      <h1></h1>
      <p></p>
      <div class="hero__actions">
        <a href="#portal" class="btn" id="ctaPrimary"></a>
        <a href="#programs" class="btn btn--ghost" id="ctaSecondary"></a>
      </div>
    </div>
  </section>

  <!-- VALUE PROPS -->
  <section class="section" id="about">
    <h2 id="propsTitle"></h2>
    <ul class="grid grid--3">
      <li class="card">
        <div class="card-icon">üë©‚Äçüè´</div>
        <h3 id="prop1Title"></h3>
        <p id="prop1Body"></p>
      </li>
      <li class="card">
        <div class="card-icon">üéÆ</div>
        <h3 id="prop2Title"></h3>
        <p id="prop2Body"></p>
      </li>
      <li class="card">
        <div class="card-icon">‚úÖ</div>
        <h3 id="prop3Title"></h3>
        <p id="prop3Body"></p>
      </li>
    </ul>
  </section>

  <!-- PROGRAMS -->
  <section class="section" id="programs">
    <h2 id="programsTitle"></h2>
    <ul id="realmsList" class="grid grid--2 grid--cards"></ul>
    <div class="center">
      <a href="#portal" class="btn" id="btnCurriculum"></a>
    </div>
  </section>

  <!-- HOW IT WORKS -->
  <section class="section section--alt" id="approach">
    <h2 id="approachTitle"></h2>
    <ul class="steps">
      <li class="step">
        <div class="step-num">1</div>
        <div class="step-body">
          <h4 id="step1Title"></h4>
          <p id="step1Body"></p>
        </div>
      </li>
      <li class="step">
        <div class="step-num">2</div>
        <div class="step-body">
          <h4 id="step2Title"></h4>
          <p id="step2Body"></p>
        </div>
      </li>
      <li class="step">
        <div class="step-num">3</div>
        <div class="step-body">
          <h4 id="step3Title"></h4>
          <p id="step3Body"></p>
        </div>
      </li>
    </ul>
  </section>

  <!-- PORTAL (Login + Sign Up) -->
  <section class="section" id="portal">
    <h2 id="portalTitle"></h2>
    <p id="portalIntro" class="muted"></p>

    <div class="grid grid--2">
      <!-- Login (parents log in, then book sessions inside the portal) -->
      <div class="card card--widget">
        <h3 id="portalLoginTitle"></h3>
        <div class="widget">
          <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQjNKeSJ9"></script>
        </div>
      </div>

      <!-- Sign Up (Parent first; single student) -->
      <div class="card card--widget">
        <h3 id="portalSignupTitle"></h3>
        <div class="widget" id="signupWidget">
          <!-- Your Sign Up widget -->
          <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQjJKTSJ9"></script>
        </div>
        <!-- Post-load tweaks (only works if widget is NOT in an iframe) -->
        <script>
          (function () {
            const container = document.getElementById('signupWidget');
            if (!container) return;

            const dalhousieSchools = [
              '', // placeholder
              'Dalhousie School (CBE K‚Äì5)',
              'H.D. Cartwright School (CBE 7‚Äì9)',
              'Sir Winston Churchill High School (CBE 10‚Äì12)',
              'St. Dominic School (CCSD K‚Äì6)'
            ];

            const obs = new MutationObserver(() => {
              try {
                // If it‚Äôs an iframe, we can‚Äôt modify inside.
                if (container.querySelector('iframe')) { obs.disconnect(); return; }

                const form = container.querySelector('form') || container;
                if (!form) return;

                // --- Reorder: Parent/Guardian above Student ---
                const findHeading = (rx) => Array.from(form.querySelectorAll('h1,h2,h3,h4,h5,h6'))
                  .find(h => rx.test(h.textContent.trim()));
                const parentH = findHeading(/parent|guardian/i);
                const studentH = findHeading(/student/i);
                if (parentH && studentH) {
                  const parentBlock = parentH.nextElementSibling;
                  if (studentH.compareDocumentPosition(parentH) & Node.DOCUMENT_POSITION_FOLLOWING) {
                    form.insertBefore(parentH, studentH);
                    if (parentBlock) form.insertBefore(parentBlock, studentH);
                  }
                }

                // --- Hide Student Phone + Skill Level ---
                const hideByLabel = (rx) => {
                  const labels = form.querySelectorAll('label, .field-label, .mdc-floating-label, .mat-mdc-floating-label');
                  labels.forEach(l => {
                    if (rx.test(l.textContent.trim())) {
                      const field = l.closest('.field, .form-group, .mat-mdc-form-field, .tb-field, li, div');
                      if (field) field.style.display = 'none';
                    }
                  });
                };
                hideByLabel(/student\s*phone/i);
                hideByLabel(/skill\s*level/i);

                // --- Convert "Current School" to a dropdown with Dalhousie options ---
                const labels = Array.from(form.querySelectorAll('label, .field-label, .mdc-floating-label, .mat-mdc-floating-label'));
                const schoolLabel = labels.find(l => /current\s*school/i.test(l.textContent.trim()));
                if (schoolLabel) {
                  const fieldWrap = schoolLabel.closest('.field, .form-group, .mat-mdc-form-field, .tb-field, div');
                  const input = fieldWrap && fieldWrap.querySelector('input[type="text"], input:not([type]), textarea');
                  if (input) {
                    const select = document.createElement('select');
                    select.name = input.name || 'currentSchool';
                    select.required = input.required || false;
                    select.style.width = '100%';
                    dalhousieSchools.forEach(v => {
                      const o = document.createElement('option');
                      o.value = v;
                      o.textContent = v || 'Select your school';
                      select.appendChild(o);
                    });
                    input.replaceWith(select);
                  }
                }

                obs.disconnect();
              } catch (e) {
                console.warn('Sign-up tweak warning:', e);
              }
            });

            obs.observe(container, { childList: true, subtree: true });
          })();
        </script>
      </div>
    </div>
  </section>

  <!-- CONTACT (form + map; phone/email in footer) -->
  <section class="section" id="contact">
    <h2 id="contactTitle"></h2>
    <div class="contact-grid">
      <div class="card card--widget">
        <div class="widget">
          <script src="https://app.tutorbird.com/Widget/v4/Widget.ashx?settings=eyJTY2hvb2xJRCI6InNjaF9ZYmxKWiIsIldlYnNpdGVJRCI6Indic181M3pKSCIsIldlYnNpdGVCbG9ja0lEIjoid2JiX0RwQkRKSCJ9"></script>
        </div>
      </div>
      <div class="map">
        <iframe
          src="https://www.google.com/maps?q=Unit%207%2C%205505%20Shaganappi%20Trail%20NW%2C%20Calgary%2C%20AB%20T3A%201Z6&output=embed"
          width="100%" height="350" style="border:0; border-radius:12px;" allowfullscreen="" loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"></iframe>
        <p class="muted" id="mapNote"></p>
      </div>
    </div>
  </section>

<footer>
  <div class="footer-inner">
    <p class="contact">
      <strong>Email:</strong> <a href="mailto:learn@curiousgenius.ca">learn@curiousgenius.ca</a>
      <span class="sep">|</span>
      <strong>Phone:</strong> <a href="tel:14038301013">403-830-1013</a>
    </p>
    <p id="footerNote"></p>
  </div>
</footer>

</body>
</html>
